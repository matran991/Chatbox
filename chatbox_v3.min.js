function close_video(){$(".popup").fadeOut(500),$(this).next().remove()}function youtube(){var a=$(this).attr("href"),b='<iframe width="480" height="320" src="'+a+'?autoplay=1" frameborder="0" allowfullscreen=""></iframe>';$(".video").append(b),$(".popup").fadeIn(500)}function onchat(){$.get("/chatbox/actions.forum?archives=1&avatar=0&method=connect&tid="+tid).done(function(a){getchat(),chat_data=a})}function copyname(){$("#text").val(""+$("#text").val()+" \uf0e5 "+$(this).text()+": ")}function chat_tab(){var a=$(this).attr("data"),b=$(this).attr("style"),c=Number(new Date),d=$(this).text();if(user_chatlv>1&&nickname!=d&&($(".tab_level").fadeIn(500),$(".tab_level span").attr("name",""+d)),"true"==a&&0==$('.list_pri a[data="'+d+'"]').length&&d!=nickname)$("#Cboxvhg").attr("key",""+c),$(".result").fadeOut(500),$("#Chatboxvhg").append('<div class="result" key="'+c+'"></div>'),$(".list_pri").append('<div class="block_pri"><a style="'+b+'" href="javascript:;" onclick="show_pri.call(this);" key="'+c+'" data="'+d+'">'+d+"</a></div>");else if(d==nickname)alert("B\u1ea1n kh\xf4ng th\u1ec3 t\u1ef1 g\u1eedi cho ch\xednh m\xednh.");else if($('.list_pri a[data="'+d+'"]').length>0){$(".result").hide();var a=$('.list_pri a[data="'+d+'"]').attr("key");$('.result[key="'+a+'"]').fadeIn(500)}else lert("Th\xe0nh vi\xean n\xe0y \u0111\xe3 r\u1eddi kh\u1ecfi chatbox.")}function control(){var a=$(this).attr("name"),b=$(this).attr("data"),c=encodeURIComponent("/"+b+" "+a);if($(".tab_level").fadeOut(500),data_chat="message="+c+"&method=send&archives=1",sendchat(),"band"==b){localStorage.setItem("user_band",""+a);var d='<a style="color:#000000" data="false" href="javascript:;" onmousedown="bandder.call(this);event.preventDefault();">'+a+"</a>";$(".list_onl .user_band").append(d)}"close"==b&&$(".tab_level").fadeOut(500)}function bandder(){var a=confirm("Unband th\xe0nh vi\xean n\xe0y ch\u1ee9?");if(1==a){localStorage.clear("user_band");var b=$(this).text(),c=encodeURIComponent("/unband "+b);$(".user_band").html(""),data_chat="message="+c+"&method=send&archives=1",sendchat()}}function show_pri(){var a=$(this).attr("key");$(".rprimsg,.result").hide(),$('.result[key="'+a+'"],.rchatall').fadeIn(500),$("#Cboxvhg").attr("key",""+a)}function rpri(){var a=$(this).attr("key");$(".rprimsg").hide(),$('.result[key="'+a+'"],.rchatall').fadeIn(500),$("#Cboxvhg").attr("key",""+a)}function chatall(){$(".result").hide(),$('.result[key="chatall"],.rprimsg').fadeIn(500),$("#Cboxvhg").attr("key","chatall")}function user_onl(){if(getdata.users){for(var a="",b=0;b<getdata.users.length;b++){var c=getdata.users[b],d='<a style="color:'+c.color+'" data="'+c.online+'" href="javascript:;" onmousedown="chat_tab.call(this);">'+c.username+"</a>";a+=d,c.username==nickname&&(user_admin=c.admin,user_chatlv=c.chatLevel,user_userlv=c.userLevel)}$(".list_onl .user_onl").html(a)}}function buzzon(){"true"==buzz&&($("body").toggleClass("shake animated infinite"),$("#chatbox-buzz-audio")[0].play(),buzz="false",setTimeout(function(){$("body").removeClass("shake animated infinite")},2e3))}function primsg(){var a=getdata.messages.length-1;$(".result").not('.result[key="chatall"]').html("");for(var b=a;b>-1;b--){var c=getdata.messages[b];if(void 0==c.user||null==c.user_avatar.length)var e="";else if(null!=c.user_avatar.length)var e='<img src="'+c.user.avatar+'" />';else c.user.color;if(c.msg.indexOf("||"+nickname+"||")>-1&&"none"!=nickname){var f=c.msg.split("||"),g=f[0],h=f[1],i=f[2],j=f[3];if(h==nickname)var k=i;else if(i==nickname)var k=h;if(0==$('#Chatboxvhg .result[key="'+g+'"]').length&&($(".tit_pri,.list_pri").fadeIn(500),0==$('.box_onl .list_pri a[data="'+k+'"]').length&&$(".box_onl .list_pri").append('<div class="block_pri"><a href="javascript:;" onclick="show_pri.call(this);" key="'+g+'" data="'+k+'">'+k+'</a><span class="number" name="'+k+'"></span></div>'),$("#Chatboxvhg").append('<div class="result" key="'+g+'" style="display:none"></div>')),j.search(/www\.youtube\.com\/embed|/gi)>-1)var j=j.replace(/href\=\"http\:/gi,'onclick="event.preventDefault();youtube.call(this);" href="http://');var l='<p key="'+g+'" class="block_mess">';l+='<span class="chat_msg"><span class="chat_name">'+e+'<a style="color:'+c.user.color+'" href="/u'+c.userId+'" onclick="event.preventDefault();copyname.call(this)">'+c.username+'</a>: </span><span class="chat_content">'+Base64.decode(j)+"</span></span>",l+="</p>",$('#Chatboxvhg .result[key="'+g+'"]').append(l),$(".result").not('.result[key="chatall"]').each(function(){var a=$(this).find(".block_mess").attr("key"),b=$(this).find(".block_mess").length;$('.block_pri a[key="'+a+'"]').next().text(b)})}}}function msgchat(){if(getdata.messages&&(contentz="",getdata.messages))if(0==lastmess||0==$('.result[key="chatall"] p').length){lastmess=getdata.messages.length;for(var a=getdata.messages.length-1,b=a;b>-1;b--){var c=getdata.messages[b],d=c.userId,e=c.username,f=c.msg;if(f.search(/kicked by|banned by|Messages cleared/gi)>-1)var f=""+f.replace("has been unbanned by","\u0111\xe3 \u0111\u01b0\u1ee3c unbanded b\u1edfi").replace("has been kicked by","\u0111\xe3 b\u1ecb \u0111\xe1 ra kh\u1ecfi ph\xf2ng b\u1edfi").replace("Messages cleared by","C\xe1c tin nh\u1eafn \u0111\xe3 b\u1ecb x\xf3a b\u1edfi").replace("has been banned by","\u0111\xe3 b\u1ecb banded b\u1edfi"),g='<p class="block_mess"><span class="chat_content warning">'+f+"</span></p>";else if(f.indexOf("||"+nickname+"||")>-1)var g="";else{if(f.indexOf("www.youtube.com/embed")>-1)var f=f.replace(/href\=\"http\:/gi,'onclick="event.preventDefault();youtube.call(this);" href="http://');if(f.search("{BUZZ}")>-1)var f='<span class="BUZZ">BUZZ</span>';if(void 0==c.user||null==c.user_avatar.length)var h="inherit",i="";else var h=c.user.color;if(null!=c.user_avatar)var i='<img src="'+c.user.avatar+'" />';var g='<p class="block_mess">';g+='<span class="chat_msg"><span class="chat_name">'+i+'<a style="color:'+h+'" href="/u'+c.userId+'" onclick="event.preventDefault();copyname.call(this)">'+c.username+'</a>: </span><span class="chat_content">'+f+"</span></span>",g+="</p>"}contentz+=g}$('.result[key="chatall"]').html(contentz)}else if(getdata.messages.length>lastmess){for(var j=getdata.messages.length,k=lastmess,b=k;j>b;b++){var c=getdata.messages[b],d=c.userId,e=c.username,f=c.msg;if(f.indexOf("||"+nickname+"||")>-1)var g="";else{if(f.indexOf("www.youtube.com/embed")>-1)var f=f.replace(/href\=\"http\:/gi,'onclick="event.preventDefault();youtube.call(this);" href="http://');if(f.search("{BUZZ}")>-1){var f='<span class="BUZZ">BUZZ</span>';b==j-1&&"false"==buzz&&(buzz="true",buzzon())}if(void 0==c.user||null==c.user_avatar)var h="inherit",i="";else var h=c.user.color;if(null!=c.user_avatar)var i='<img src="'+c.user.avatar+'" />';if(f.search(/kicked by|banned by|Messages cleared/gi)>-1)var f=""+f.replace("has been unbanned by","\u0111\xe3 \u0111\u01b0\u1ee3c unbanded b\u1edfi").replace("has been kicked by","\u0111\xe3 b\u1ecb \u0111\xe1 ra kh\u1ecfi ph\xf2ng b\u1edfi").replace("Messages cleared by","C\xe1c tin nh\u1eafn \u0111\xe3 b\u1ecb x\xf3a b\u1edfi"),g='<p class="block_mess"><span class="chat_content warning">'+f+"</span></p>";else{var g='<p class="block_mess">';g+='<span class="chat_msg"><span class="chat_name">'+i+'<a style="color:'+h+'" href="/u'+d+'" onclick="event.preventDefault();copyname.call(this)">'+e+'</a>: </span><span class="chat_content">'+f+"</span></span>",g+="</p>"}$('.result[key="chatall"] .block_mess:first').before(g)}}lastmess=getdata.messages.length}}function getchat(){$.ajax({url:"chatbox/actions.forum?method=get&tid="+tid+"&archives=1",type:"get",dataType:"json",cache:!1,success:function(a){getdata=a,getdata.messages[0].msg.indexOf("You are disconnected")>-1&&onchat(),getdata.messages[getdata.messages.length-1].msg.indexOf("Messages cleared")>-1&&(lastmess=0),msgchat(),primsg(),user_onl()}})}function sendchat(){data=data_chat,document.Cboxvhg.text.value="",$.ajax({url:"/chatbox/actions.forum",type:"post",data:data,dataType:"json",cache:!1,success:function(){getchat()}})}var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var c,d,e,f,g,h,i,b="",j=0;for(a=Base64._utf8_encode(a);j<a.length;)c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=a.charCodeAt(j++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),b=b+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h)+this._keyStr.charAt(i);return b},decode:function(a){var c,d,e,f,g,h,i,b="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),i=this._keyStr.indexOf(a.charAt(j++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,b+=String.fromCharCode(c),64!=h&&(b+=String.fromCharCode(d)),64!=i&&(b+=String.fromCharCode(e));return b=Base64._utf8_decode(b)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(192|d>>6),b+=String.fromCharCode(128|63&d)):(b+=String.fromCharCode(224|d>>12),b+=String.fromCharCode(128|63&d>>6),b+=String.fromCharCode(128|63&d))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}};$.get("/chatbox").done(function(a){tid=a.split('new Chatbox("')[1].split('", {')[0],onchat()});var nickname="none",lastmess=0,buzz="false",buzzbtt="no";if(null==localStorage.getItem("nickname")?$.get("/post").done(function(a){nickname=a.split('_userdata["username"] = "')[1].split('";')[0],localStorage.setItem("nickname",""+nickname)}):nickname=localStorage.getItem("nickname"),auto2=setInterval(function(){getchat()},3e3),null!=localStorage.getItem("user_band")){var a=localStorage.getItem("user_band"),d='<a style="color:#000000" data="false" href="javascript:;" onmousedown="bandder.call(this);event.preventDefault();">'+a+"</a>";$(".list_onl .user_band").append(d)}$("#Cboxvhg").submit(function(a){if(a.preventDefault(),""==document.Cboxvhg.text.value)alert("B\u1ea1n ch\u01b0a nh\u1eadp n\u1ed9i dung chat.");else if(document.Cboxvhg.text.value.length>255)alert("N\u1ed9i dung b\u1ea1n nh\u1eadp qu\xe1 d\xe0i."),document.Cboxvhg.text.value="";else{var b=$(this).attr("key"),c=$('.list_pri a[key="'+b+'"]').text();data_chat="chatall"==b?""+$("input#text").serialize()+"&method=send&archives=1":""+$("input#text").val(Base64.encode($("input#text").val())).serialize().replace("message=","message="+b+"||"+nickname+"||"+c+"||")+"&method=send&archives=1",sendchat(),document.Cboxvhg.text.value=""}}),$("#chen_link").toggle(function(){$(".tab_drop").slideUp(300),$("#linkdechen").slideDown(300)},function(){$(".tab_drop").slideUp(300)}),$("#divsmilies").toggle(function(){$(".tab_drop").slideUp(300),$("#smiley_FB_frame").slideDown(300)},function(){$(".tab_drop").slideUp(300)}),$(".nutchenlink").click(function(){$("#text").val(""+$("#text").val()+"[url]"+$("#link_chen").val()+"[/url]"),$(".tab_drop").slideUp(300),$("input#link_chen").val("")}),$(".nutchenanh").click(function(){var a=$("#link_chen").val();a.search(/png|gif|jpg/gi)>-1?($("#text").val("[img]"+a+"[/img]"),$(".tab_drop").slideUp(300),$("#link_chen").val("")):alert("Xin l\u1ed7i \u0111\xe2y kh\xf4ng ph\u1ea3i \u0111\u1ecbnh d\u1ea1ng \u1ea3nh h\u1ed7 tr\u1ee3.")}),$(".nutchenvideo").click(function(){if($("#link_chen").val().length>5){var a=$("#link_chen").val().match(/(?:v=|v\/|embed\/|youtu.be\/)(.{11})/)[1];data_chat="message="+$("#text").val()+"[url=http://www.youtube.com/embed/"+a+"][img]https://img.youtube.com/vi/"+a+"/0.jpg[/img][/url]&method=send&archives=1",sendchat(),$(".tab_drop").slideUp(300),$("#link_chen").val("")}else alert("Xin vui l\xf2ng ch\xe8n link v\xe0o khung.")}),$("#smiley_FB_frame sub").click(function(){var a=encodeURIComponent(""+$("#text").val()+"[sub]"+$(this).text()+"[/sub]");$(".tab_drop").slideUp(300),data_chat="message="+a+"&method=send&archives=1",sendchat()}),$("#chatbox-option-buzz").click(function(){if("no"==buzzbtt){var a=encodeURIComponent("{BUZZ}");data_chat="message="+a+"&method=send&archives=1",sendchat(),buzzbtt="yes";var b=59;$buzz=$("#chatbox-option-buzz"),timeBuzzCount=setInterval(function(){var a=b--;$buzz.attr("value",""+a),0>=a&&(clearInterval(timeBuzzCount),b=59,timeBuzzCount=void 0,$buzz.attr("value","\uf0e7 BUZZ"),buzzbtt="no")},1e3)}});
